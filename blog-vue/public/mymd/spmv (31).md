# SPMV稀疏矩阵向量乘笔记（31）
## yaSpMV: Yet Another SpMV Framework on GPUs  浅读 (2)
### **The Block-based Compressed Common Coordinate (BCCOO) Format**
![matrix](/mymd/学习日记-spmv（31）/matrix.png)
* 提出了COO格式的优点和缺点，优点是在实现并行时不会存在负载均衡问题，缺点是每个非零元都需要存储它的行列值，非常占据空间，所以它的内存占用非常差
* BCCOO将row_index做了一个差值，并且翻转。ex，(0,0,1,1,1)->(0,1,0,0,1)->(1,0,1,1,0)使得0表示该块是这一行非零元块的最后一块，这样就可以给row_index进行无损压缩。(都为1/0的话，可以用bit存，即一个字节可以存8位数据)

![BCCOO](/mymd/学习日记-spmv（31）/BCCOO.png)
* BCCOO+格式先把矩阵垂直切片，然后bitflag是根据切片后的矩阵，与BCCOO相同，0表示一行的结束，但是col_index是根据为未切片前的矩阵的列索引来存储的

![BCCOO+](/mymd/学习日记-spmv（31）/BCC00+.png)
* BCCOO+的好处就是，在同一个切片中，需要用到的y都是同一个范围内的，这样程序的局部性就得到了一定的保证，但是缺点是，因为是执行切片后的乘法结果不是最终的结果，所以需要将中间结果缓存起来，最后做一个合并，但是这样可能就需要一个比较大的缓冲区，从而导致了性能瓶颈。所以两种格式并没有绝对的好与坏，后续论文将采用自动调优来确定使用这两种格式中的哪种。

![adv](/mymd/学习日记-spmv（31）/adv.png)
* 最后做了一个辅助信息，就是根据线程处理非零块的数量，记录每个线程生成的第一个结果的位置