# Redis集群相关
## 介绍一下redis的主从同步
单节点Redis的并发能力是有上限的，要进一步提高Redis的并发能力，就需要搭建主从集群，实现读写分离.一般都是一主多从，主节点负责写数据，从节点负责读数据
## 能说一下，主从同步数据的流程
### 全量同步
- 从节点请求主节点同步数据 (replication id、offset )
- 主节点判断是否是第一次请求，是第一次就与从节点同步版本信息 (replication id和offset)
- 主节点执行bgsave，生成rdb文件后，发送给从节点去执行
- 在rdb生成执行期间，主节点会以命令的方式记录到缓冲区(一个日志文件)
- 把生成之后的命令日志文件发送给从节点进行同步
### 增量同步
- 从节点请求主节点同步数据，主节点判断不是第一次请求，不是第一次就获取从节点的offset值
- 主节点从命令日志中获取offset值之后的数据，发送给从节点进行数据同步
## 怎么保证Redis的高并发高可用
哨兵模式:实现主从集群的自动故障恢复(监控、自动故障恢复、通知)
## 你们使用redis是单点还是集群，哪种集群
主从(1主1从)+哨兵就可以了。单节点不超过10G内存，如果Redis内存不足则可以给不同服务分配独立的Redis主从节点
## redis集群脑裂，该怎么解决呢?
- 集群脑裂是由于主节点和从节点和sentinel处于不同的网络分区，使得sentinel没有能够心跳感知到主节点，所以通过枚举的方式提升了一个从节点为主，这样就存在了两个master，就像大脑分裂了一样，这样会导致客户端还在老的主节点那里写入数据，新节点无法同步数据，当网络恢复后，sentinel会将老的主节点降为从节点，这时再从新master同步数据，就会导致数据丢失
- 解决:我们可以修改redis的配置，可以设置最少的从节点数量以及缩短主从数据同步的延迟时间，达不到要求就拒绝请求就可以避免大量的数据丢失
## redis的分片集群有什么作用
- 集群中有多个master，每个master保存不同数据
- 每个master都可以有多个slave节点
- master之间通过ping监测彼此健康状态
- 客户端请求可以访问集群任意节点，最终都会被转发到正确节点
## Redis分片集群中数据是怎么存储和读取的?
- Redis 分片集群引入了哈希槽的概念，Redis 集群有 16384 个哈希槽将16384个插槽分配到不同的实例
- 读写数据:根据key的有效部分计算哈希值，对16384取余(有效部分，如果key前面有大括号，大括号的内容就是有效部分，如果没有，则以key本身做为有效部分)余数做为插槽，寻找插槽所在的实例